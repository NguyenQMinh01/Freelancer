<section class="section">
    <div class="container">
        <div class="columns">
            
            <!-- LEFT SIDE -->
            <div class="column is-one-third">
                <div class="columns is-multiline">

                    <!-- Top Card -->
                    <div class="column is-full">
                        <div class="card">

                            <!-- Avatar -->
                            <div class="card-content is-horizontal-center is-flex">
                                <figure class="image is-128x128">
                                    <%= image_tag avatar_url(@user), class: "is-rounded", style: "border: 2px solid black;" %>
                                </figure>

                            </div>

                            <div class="card-content">

                            
                                <!-- Upload Button Contact -->
                                <div class="content has-text-centered">
                                    <p class="title is-5"><%= @user.full_name %></p>  
                                       <% if current_user.id != @user.id %>

                                            <a onclick="message()" class="button is-black is-outlined is-fullwidth toggle-contact">Contact Via Message</a>
                                       <% end %>
                                </div>
                                <hr class="h-10">
                                
                                <!-- Member -->
                                <article class="media">
                                    <div class = "media-content">Member since</div>
                                    <div class = "media-right">
                                        <strong> <%= @user.created_at.strftime('%b %Y') %> </strong>
                                    </div>
                                </article>
                                <hr class="h-10">
                                
                                <!-- From -->
                                <article class="media" >                    
                                    <div class = "media-content">From </div>
                                        <div class = "media-right">
                                            <strong><%= @user.from %> </strong>
                                    </div>                                                                                                       
                                </article>                                
                                <hr class="h-10">

                                <!-- Online Status -->
                                <article class="media" >  
                                    <div class = "media-content">Online</div>                                  
                                    <div class = "media-right">
                                        <strong> <% if @user.status %> Online <% else %> Offline <% end %> </strong>
                                    </div>                               
                                </article>  

                            </div>
                        </div>
                    </div>

                    <!-- Bottom Card -->
                    <div class="column is-full">
                        <div class="card">
                            <div class="card-content">

                                <!-- About -->     
                                    <article class="media">
                                        <div class = "media-content"> 
                                            <p>
                                                <strong>About Your self </strong>
                                                <br>
                                                <%= @user.about %>
                                            </p>  
                                        </div>
                                                          
                                </article>  
                                <hr class="h-10">

                                <!-- Language -->
                        
                                    <article class="media">
                                        <div class = "media-content"> 
                                        <p>
                                            <strong>Language </strong>
                                            <br>
                                            <%= @user.language %>
                                        </p>  
                                    </div>
                                </article>
                                <hr class="h-10">
                                
                                <!-- Linked Account -->
                                <article class="media"></article>
                                <%= link_to "Back your dashboard", dashboard_path , class: "button is-hovered is-fullwidth m-t-10 m-b-10 text-white", style:"background: -webkit-linear-gradient(left,#B80909,#D01818,#E71919,#F84C4C);" %>

                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="card" style="width: 340%; height: 120%;margin-top: 1%;">
                <div class="column">
                <div class="card">
                    <div class="card-header-title is-centered">
                        <h2>My Gigs</h2>
                    </div>
                </div>
                <hr/>
                <div class="columns is-multiline">

                    <!-- Sample Gig -->
                    <% @gig.each do |gig| %>
                    <div class="column is-one-third">
                        <div class="card">

                            <div class="card-image">
                                <%= link_to edit_gig_path(gig) do %>
                                <figure class="image is-4by3">
                                    <!-- Gig Cover Image Here -->
                                    <%= image_tag gig_cover(gig) %>
                                </figure>
                                <% end %> 
                            </div>

                            <div class="card-content p-t-5 p-b-5">
                                <p class="subtitle is-6 m-b-5"><%= link_to gig.title, gig_path(gig) %></p>
                                <span class="star-review"><i class="fa fa-star"></i>
                                    <%= gig.average_rating %>
                                    <span class="has-text-primary">Reviews (<%= gig.reviews.count%>)</span>
                                </span>                                        
                            </div>

                            <footer class="card-footer">
                                <% basic_price = gig.pricings.find { |p| p.pricing_type == 'basic' } %>

                                <a class="has-text-danger is-block card-footer-item has-text-center">
                                    <% if !basic_price.nil? && basic_price.price.to_s != ""  %>
                                        <span class="small-title">STARTING AT </span>
                                        <strong>$<%= basic_price.price  %></strong> 
                                    <% else %>
                                        <strong> 
                                            <span class="small-title has-text-dark">NO PRICICNG YET </span>
                                        </strong>    
                                    <% end %>                                       
                                </a>
                            </footer>  
                            
                        </div>
                    </div>
                    <% end %>
                </div>
                <!-- Pagination -->
                <div class="card">
                    <div class="card-header-title is-centered">
                        <%= paginate @gig %>
                    </div>
                </div>
            </div>

                <hr/>
                <div class="card" style="margin: 10px;">
                    <div class = "card-hearder">
                        <div class="card-header-title">Latest Review</div>
                    </div>

                    <!-- Sample reviews -->
                    <div class="card-content">
                        <% @reviews.each do |review|%>
                        <article class="media">
                            <figure class=" media-left">
                                <p class="image is-64x64">
                                    <%= image_tag avatar_url(review.buyer), class: "is-rounded", style: "border: 2px solid black;"%>
                                    
                                </p>
                            </figure> 
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        <strong><%= review.buyer.full_name%></strong><br>
                                        <%= review.review%>
                                        
                                    </p>

                                    <small><%= time_ago_in_words(review.created_at)%></small>
                                </div>
                            </div>

                            <div class="media-right">
                                <span class="star-review"><i class="fa fa-star"></i><%= review.stars %></span>
                            </div>
                        </article>

                        <% end %>
                    </div>

                    <div class="column is-one-third has-text-centered"></div>
                </div>
            
            </div>
            
        </div>
    </div>
</section>

<!----  MODALLL  CONTACT MESSAGES    -->

<div class="modal" id="contact-form">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Send a Message</p>
            <button onclick="close_message()" class="delete toggle-contact" aria-label="close"></button>
        </header>
        <section class="modal-card-body">
            <div class="columns">
                <div class="column is-one-third">
                    <div class="card" st>
                        <div class="card-content is-horizontal-center is-flex">
                            <figure class="image is-128x128">
                                <%= image_tag avatar_url(@user), class: "is-rounded"%>
                            </figure>
                        </div>
                        <div class="card-content">
                            <hr>
                            <strong>Please include:</strong>
                            <ul class="is-size-7" style="list-style:initial">
                                <li>Ruby on rails</li>
                                <li>Design Web</li>
                                <li>Fullstack developer</li>
                                <li>nickname tinder: ngồi trong toalet gào thét tên em</li>
                            </ul>
                        </div>
                     </div>
                </div>   
                <div class="column">
                    <%= form_with model: Message.new do |f| %>
                        <%= f.hidden_field :receiver_id, value: @user.id%>
                        <div class="card-content">
                            <div class="field">
                                <div class="control">
                                    <%= f.text_area :content, class: "textarea" %>
                                </div>
                            </div>
                            <%= f.submit "Send" , class: "button is-danger is-pulled-right" %>
                        </div>
                    <% end %>
                </div>
            </div>
        </section>
    </div>
</div>
<script>
    function message(){
        var toggle_modal = $('.toggle-contact');
        if(toggle_modal )
        {
            var e = window.event;
            e.stopPropagation();
            e.preventDefault();
            var form = document.getElementById('contact-form');
            form.classList.toggle('is-active');
        }
    }

    function close_message(){
        var toggle_modal = $('.toggle-contact');
        if(toggle_modal )
        {
            var e = window.event;
            e.stopPropagation();
            e.preventDefault();
            var form = document.getElementById('contact-form');
            form.classList.toggle('is-active');
        }
    }
</script>