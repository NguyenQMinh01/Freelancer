<!DOCTYPE html>
<html lang="fr">
<head>
<!-- Site meta -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- CSS -->
<link
	href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
	rel="stylesheet" type="text/css">

</head>
<body>
<%= render 'shared/categories'%>

<section class="section">
    <div class="container">
        <div class="columns">

            <!-- LEFT SIDE -->
            <div class="column is-two-thirds">
                <div class="columns is-multiline">

                    <div class="column is-full">     
                        <div class="card">
                            <div class="card-content">
                                <div class="content">
                                    <p class="title is-4"><%= @gig.title%></p>
                                </div>
                                <hr>
                                <div class ="hero-carousel" id = "carousel-photo">
                                    <!--  -->
                                    <div id="carouselExampleIndicators" class="carousel slide"
                                        data-ride="carousel">
                                        <ol class="carousel-indicators">
                                            <% @gig.photos.each do |photo| %>     
                                                <li data-target="#carouselExampleIndicators"></li>
                                            <% end %>
                                        </ol>
                                        <div class="carousel-inner">
                                            <% @gig.photos.each_with_index do |photo, index| %>
                                                <% if index == 0 %>
                                                    <div class="carousel-item active">
                                                        <%= image_tag url_for(photo),class: "d-block w-100", width: "100%" %>
                                                    </div>
                                                <% else %>
                                                    <div class="carousel-item">
                                                        <%= image_tag url_for(photo),class: "d-block w-100", width: "100%" %>
                                                    </div>
                                                <% end %>
                                            <% end %> 
                                        </div>
                                        <a class="carousel-control-prev" href="#carouselExampleIndicators"
                                            role="button" data-slide="prev"> <span
                                            class="carousel-control-prev-icon" aria-hidden="true"></span> <span
                                            class="sr-only">Previous</span>
                                        </a> <a class="carousel-control-next" href="#carouselExampleIndicators"
                                            role="button" data-slide="next"> <span
                                            class="carousel-control-next-icon" aria-hidden="true"></span> <span
                                            class="sr-only">Next</span>
                                        </a>
                                    </div>
                                    <br/>
                                    <% if @gig.video.present? %>
                                        <div class ="video-container">
                                            <iframe width="100%" height="300px" src=<%= url_for(@gig.video).gsub('watch?v=', 'embed/') %> frameborder="0" allowfullscreen ></iframe>
                                        </div>
                                    <% end %>
                                </div>
                            </div>
                        </div>                   
                    </div>

                    <!-- About Section -->
                    <div class="column">
                        <div class="card">
                            <div class="card-content">
                                <article class="media">
                                    <div class="media-content">
                                        <p><strong>About this gig</strong></p>
                                        <hr>
                                        <%= @gig.description %>
                                    </div>
                                </article>
                            </div>
                        </div>                        
                    </div>
                    
                </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="column">
                <div class="columns is-multiline">

                    <!-- Pricing Section -->
                    
                    <div class="column is-full">

                        <div class="tabs is-fullwidth" id="tabs">
                            <ul>
                                <% Pricing.pricing_types.each do |key, value|%>
                                <li onclick="switch_tab()" class="tab<%= ' is-active' if value  == 0 %>"
                                             data-tab="<%= key %>"style = "<%= 'display: none' if @gig.has_single_pricing && value != 0 %>" >
                                    <a><%= key.capitalize %></a>
                                </li>
                                <% end %>
                            </ul>
                        </div>

                        <div class="tabs-content">
                            <% @gig.pricings.each do |p| %>
                                <div class="tab-content" id="tab-<%= p.pricing_type%>"style = "<%= 'display: none' if !p.basic? %>">
                                    <div class="card">
                                        <div class="card-content">
                                            <div class="media">
                                                <div class="media-content">
                                                    <strong><%= p.title %></strong>                                                                                                        
                                                </div>
                                                <div class="media-right">
                                                    <p class="title is-4">$<%= p.price %></p>
                                                </div>                                                
                                            </div>
                                            <div class="content f-15">
                                                <p class="m-t-30"><%= p.description%></p>
                                                <p class="m-t-30">
                                                    <strong><i class="far fa-clock"></i> <%= pluralize(p.delivery_time, 'Days') %> Delivery</strong>                                                    
                                                </p>
                                            </div>
                                            <% if (user_signed_in? && @gig.active) || (user_signed_in? && @gig.active && @gig.user_id != current_user.id) %>
                                                <%= form_for([@gig, @gig.orders.new]) do |f| %>
                                                    <%= hidden_field_tag 'pricing_type', p.pricing_type %>
                                                    <%= f.submit "Continue ($#{p.price})", class: "button is-fullwidth is-danger" , data: {confirm: "are you sure?"}%>
                                                <% end %>
                                            <% else %>
                                                <button class="button is-fullwidth is-danger" disabled>Not Available</button>
                                            <% end %>
                                        </div>
                                    </div>
                            </div>
                            <% end %>
                        </div>
                    </div>

                    <!-- Profile Section -->
                    <div class="column">
                        <div class="card">
                            <div class="card-content is-horizontal-center is-flex" style="justify-content: center; margin-bottom: -10%;">
                                <figure class="image" style="width: 60%">
                                    <!-- User Avatar Here -->
                                    <%= image_tag avatar_url(@gig.user), class: "is-rounded", style: "border: 2px solid black" %>
                                </figure>
                            </div>  
                            <div class="card-content f-15">
                                <div class="content has-text-centered">
                                    <p class="title is-5"><%= @gig.user.full_name%></p>
                                    <button class="button is-black is-outlined is-fullwidth">Contact me</button>
                                </div>
                                <article class="media">
                                    <div class="media-content">
                                        <i class="fas fa-user m-r-5"></i> Member since
                                    </div>
                                    <div class="media-right">
                                        <%= @gig.user.created_at.strftime('%b %Y')%>
                                    </div>
                                </article>
                                <article class="media">
                                    <div class="media-content">
                                        <i class="fas fa-map-marker-alt m-r-5"></i> From
                                    </div>
                                    <div class="media-right">
                                        <%= @gig.user.from %>
                                    </div> 
                                </article>
                                <article class="media">
                                    <div class="media-content">
                                        <i class="fas fa-user m-r-5"></i> About me
                                    </div> 
                                    <div class="media-right">
                                        <%= @gig.user.about %>
                                    </div> 

                                </article>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
        </div>
    </div>
</section>
	<!-- JS -->
	<script src="//code.jquery.com/jquery-3.2.1.slim.min.js"
		type="text/javascript"></script>
	<script
		src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		type="text/javascript"></script>
	<script
		src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
		type="text/javascript"></script>

</body>
</html>
<script>
    BulmaCarousel.attach('#carousel-photo',{
        slidesToScroll: 1,
        slidesToShow: 1
    })

    function switch_tab(){
        $('#tabs li').on('click', function(){
            var type = $(this).data('tab');

            $('#tabs li').removeClass('is-active');
            $(this).addClass('is-active');
            $('.tab-content').hide()
            $('#tab-' + type).show();
        })
    }

    // $(document).ready(function(){
    //     $('#tabs li').on('click', function(){
    //         var type = $(this).data('tab');

    //         $('#tabs li').removeClass('is-active');
    //         $(this).addClass('is-active');
    //         $('.tab-content').hide()
    //         $('#tab-' + type).show();
    //     })
    // })()
</script>